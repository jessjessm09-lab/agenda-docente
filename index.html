<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#3B82F6">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Agenda Docente">
<title>Agenda Docente</title>
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
touch-action: manipulation;
-webkit-tap-highlight-color: transparent;
}
#root { min-height: 100vh; }
::-webkit-scrollbar { width: 8px; height: 8px; }
::-webkit-scrollbar-track { background: #f1f1f1; }
::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
::-webkit-scrollbar-thumb:hover { background: #555; }
.spinner {
border: 3px solid #f3f3f3;
border-top: 3px solid #3B82F6;
border-radius: 50%;
width: 40px;
height: 40px;
animation: spin 1s linear infinite;
margin: 0 auto;
}
@keyframes spin {
0% { transform: rotate(0deg); }
100% { transform: rotate(360deg); }
}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">

const { useState, useEffect } = React;

// ‚úÖ CONFIGURACI√ìN SUPABASE CORREGIDA
const SUPABASE_URL = 'https://bpsadxnheljilmxocvnh.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJwc2FkeG5oZWxqaWxteG9jdm5oIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzcyMzgwNzcsImV4cCI6MjA1MjgxNDA3N30.6gp_-Wo1k7qTd-i3PZOKBnFvNUCWOZ5wWBMQZmKM8Oc';

const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// ‚úÖ CORRECCI√ìN 1: FUNCI√ìN PARA TRUNCAR (NO REDONDEAR) A 2 DECIMALES
const truncarA2Decimales = (numero) => {
  const n = parseFloat(numero);
  if (isNaN(n)) return 0;
  return Math.floor(n * 100) / 100;
};

// FUNCI√ìN PARA OBTENER COLOR SEG√öN NOTA
const obtenerColorNota = (nota) => {
  const n = parseFloat(nota);
  if (isNaN(n)) return 'text-gray-600';
  if (n >= 1 && n <= 3) return 'text-red-600';
  if (n >= 4 && n <= 5) return 'text-green-600';
  if (n >= 6 && n <= 10) return 'text-blue-600';
  return 'text-gray-600';
};
    // ‚úÖ CORRECCI√ìN 2: STORAGE CON SUPABASE MEJORADO - SIN PANTALLAS DE CARGA LARGAS
window.storage = {
  async get(key) {
    try {
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) {
        const value = localStorage.getItem(key);
        return value ? { value } : null;
      }

      const { data, error } = await supabase
        .from('user_data')
        .select('data_value')
        .eq('user_id', user.id)
        .eq('data_key', key)
        .maybeSingle();

      if (error) {
        console.error('Error get:', error);
        const value = localStorage.getItem(key);
        return value ? { value } : null;
      }

      if (!data) {
        const value = localStorage.getItem(key);
        return value ? { value } : null;
      }

      const valorFinal = typeof data.data_value === 'string' ? data.data_value : JSON.stringify(data.data_value);
      localStorage.setItem(key, valorFinal);
      return { value: valorFinal };
    } catch (err) {
      console.error('Error catch get:', err);
      const value = localStorage.getItem(key);
      return value ? { value } : null;
    }
  },

  async set(key, value) {
    try {
      // ‚úÖ CORRECCI√ìN 3: GUARDAR INMEDIATAMENTE EN LOCALSTORAGE (sin esperar la nube)
      localStorage.setItem(key, value);
      
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) {
        return { key, value };
      }

      let dataValue;
      try {
        dataValue = JSON.parse(value);
      } catch {
        dataValue = value;
      }

      // ‚úÖ GUARDAR EN SUPABASE EN SEGUNDO PLANO (no bloqueante)
      supabase
        .from('user_data')
        .upsert({
          user_id: user.id,
          data_key: key,
          data_value: dataValue,
          updated_at: new Date().toISOString()
        }, {
          onConflict: 'user_id,data_key'
        })
        .then(({ error }) => {
          if (error) {
            console.error('Error guardando en nube:', error);
          }
        });

      return { key, value };
    } catch (err) {
      console.error('Error catch set:', err);
      localStorage.setItem(key, value);
      return { key, value };
    }
  }
};
    // ICONOS SVG
const School = (p) => <svg {...p} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>;
const BookOpen = (p) => <svg {...p} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/></svg>;
const Calendar = (p) => <svg {...p} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>;
const Users = (p) => <svg {...p} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/></svg>;
const ClipboardList = (p) => <svg {...p} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/></svg>;
const Clock = (p) => <svg {...p} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>;
const Plus = (p) => <svg {...p} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4"/></svg>;
const ArrowLeft = (p) => <svg {...p} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 19l-7-7m0 0l7-7m-7 7h18"/></svg>;
const Trash2 = (p) => <svg {...p} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>;
const Check = (p) => <svg {...p} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7"/></svg>;
const Palette = (p) => <svg {...p} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"/></svg>;
const ChevronLeft = (p) => <svg {...p} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7"/></svg>;
const ChevronRight = (p) => <svg {...p} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7"/></svg>;
const Save = (p) => <svg {...p} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"/></svg>;
const FileText = (p) => <svg {...p} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>;
const Edit2 = (p) => <svg {...p} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>;
const LogOut = (p) => <svg {...p} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/></svg>;
const Cloud = (p) => <svg {...p} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/></svg>;
const Mail = (p) => <svg {...p} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>;
const Lock = (p) => <svg {...p} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>;
// COMPONENTE PRINCIPAL
const AgendaDocente = () => {
  const [usuario, setUsuario] = useState(null);
  const [cargandoAuth, setCargandoAuth] = useState(true);
  const [pantallaAuth, setPantallaAuth] = useState('login');
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [errorAuth, setErrorAuth] = useState('');
  const [editandoNombre, setEditandoNombre] = useState(false);
  
  const [pantalla, setPantalla] = useState('inicio');
  const [docente, setDocente] = useState('');
  const [escuelas, setEscuelas] = useState([]);
  const [idEscuela, setIdEscuela] = useState(null);
  const [materias, setMaterias] = useState({});
  const [idMateria, setIdMateria] = useState(null);
  const [cursos, setCursos] = useState({});
  const [idCurso, setIdCurso] = useState(null);
  const [alumnos, setAlumnos] = useState({});
  const [idAlumno, setIdAlumno] = useState(null);
  const [asistencias, setAsistencias] = useState({});
  const [notas, setNotas] = useState({});
  const [libroTemas, setLibroTemas] = useState({});
  const [tema, setTema] = useState('azul');
  
  const [textoEscuela, setTextoEscuela] = useState('');
  const [textoMateria, setTextoMateria] = useState('');
  const [textoCurso, setTextoCurso] = useState('');
  const [textoAlumno, setTextoAlumno] = useState('');
  const [fechaAsist, setFechaAsist] = useState('');
  const [estadoAsist, setEstadoAsist] = useState('');
  const [trimestreNota, setTrimestreNota] = useState('1');
  const [tipoNota, setTipoNota] = useState('tp');
  const [valorNota, setValorNota] = useState('');
  const [fechaNota, setFechaNota] = useState('');
  const [descripcionNota, setDescripcionNota] = useState('');
  const [formLibro, setFormLibro] = useState(false);
  const [registroLibro, setRegistroLibro] = useState({
    fecha: '', asignatura: '', horas: '', unidad: '',
    alumnosPresentes: '', alumnosAusentes: '',
    contenidos: '', actividades: '', observaciones: '', folio: ''
  });
  
  const [horarios, setHorarios] = useState({});
  const [editandoHorario, setEditandoHorario] = useState(null);
  const [textoHorario, setTextoHorario] = useState('');
  const [horasPersonalizadas, setHorasPersonalizadas] = useState({});
  const [editandoRangoHora, setEditandoRangoHora] = useState(null);
  const [rangoHorario, setRangoHorario] = useState('');
  
  const [eventosCalendario, setEventosCalendario] = useState({});
  const [mesActual, setMesActual] = useState(new Date());
  const [diaSeleccionado, setDiaSeleccionado] = useState(null);
  const [textoEvento, setTextoEvento] = useState('');
  const [tipoEvento, setTipoEvento] = useState('general');
  const [notasPlanner, setNotasPlanner] = useState({});

  const colores = {
    azul: { n: 'Azul', p: 'bg-blue-600', s: 'bg-blue-100', t: 'text-blue-600', g: 'from-blue-500 to-blue-600' },
    verde: { n: 'Verde', p: 'bg-green-600', s: 'bg-green-100', t: 'text-green-600', g: 'from-green-500 to-green-600' },
    purpura: { n: 'P√∫rpura', p: 'bg-purple-600', s: 'bg-purple-100', t: 'text-purple-600', g: 'from-purple-500 to-purple-600' },
    gris: { n: 'Gris', p: 'bg-slate-700', s: 'bg-slate-100', t: 'text-slate-700', g: 'from-slate-600 to-slate-700' }
  };

  const col = colores[tema];
    // ‚úÖ CORRECCI√ìN 4: VERIFICAR SESI√ìN OPTIMIZADO - CARGA M√ÅS R√ÅPIDA
  useEffect(() => {
    const verificarSesion = async () => {
      try {
        const { data: { session } } = await supabase.auth.getSession();
        if (session) {
          setUsuario(session.user);
          // Cargar datos en paralelo sin bloquear
          cargar();
        }
      } catch (error) {
        console.error('Error verificando sesi√≥n:', error);
      } finally {
        setCargandoAuth(false);
      }
    };

    verificarSesion();

    const { data: { subscription } } = supabase.auth.onAuthStateChange(async (event, session) => {
      if (event === 'SIGNED_IN') {
        setUsuario(session.user);
        cargar();
      } else if (event === 'SIGNED_OUT') {
        setUsuario(null);
        setPantalla('inicio');
      }
    });

    return () => subscription.unsubscribe();
  }, []);

  const handleLogin = async (e) => {
    e.preventDefault();
    setErrorAuth('');
    
    try {
      const { data, error } = await supabase.auth.signInWithPassword({
        email,
        password
      });

      if (error) throw error;

      setUsuario(data.user);
      cargar();
    } catch (error) {
      setErrorAuth(error.message || 'Error al iniciar sesi√≥n');
    }
  };

  const handleRegister = async (e) => {
    e.preventDefault();
    setErrorAuth('');
    
    try {
      const { data, error } = await supabase.auth.signUp({
        email,
        password
      });

      if (error) throw error;

      alert('¬°Cuenta creada! Revisa tu email para confirmar tu cuenta.');
      setPantallaAuth('login');
      setEmail('');
      setPassword('');
    } catch (error) {
      setErrorAuth(error.message || 'Error al registrarse');
    }
  };

  const handleLogout = async () => {
    if (window.confirm('¬øCerrar sesi√≥n?')) {
      await supabase.auth.signOut();
      setUsuario(null);
      setPantalla('inicio');
    }
  };

  // ‚úÖ CORRECCI√ìN 5: CARGAR DATOS OPTIMIZADO - PRIMERO LO CR√çTICO, LUEGO EL RESTO
  const cargar = async () => {
    try {
      // Cargar datos cr√≠ticos primero (interfaz responde m√°s r√°pido)
      const datosCriticos = await Promise.all([
        window.storage.get('docente'),
        window.storage.get('tema'),
        window.storage.get('escuelas')
      ]);

      if (datosCriticos[0]?.value) setDocente(datosCriticos[0].value);
      if (datosCriticos[1]?.value) setTema(datosCriticos[1].value);
      if (datosCriticos[2]?.value) setEscuelas(JSON.parse(datosCriticos[2].value));

      // Cargar el resto en segundo plano (no bloqueante)
      Promise.all([
        window.storage.get('materias'),
        window.storage.get('cursos'),
        window.storage.get('alumnos'),
        window.storage.get('asistencias'),
        window.storage.get('notas'),
        window.storage.get('libroTemas'),
        window.storage.get('horarios'),
        window.storage.get('horasPersonalizadas'),
        window.storage.get('eventosCalendario'),
        window.storage.get('notasPlanner')
      ]).then(datos => {
        if (datos[0]?.value) setMaterias(JSON.parse(datos[0].value));
        if (datos[1]?.value) setCursos(JSON.parse(datos[1].value));
        if (datos[2]?.value) setAlumnos(JSON.parse(datos[2].value));
        if (datos[3]?.value) setAsistencias(JSON.parse(datos[3].value));
        if (datos[4]?.value) setNotas(JSON.parse(datos[4].value));
        if (datos[5]?.value) setLibroTemas(JSON.parse(datos[5].value));
        if (datos[6]?.value) setHorarios(JSON.parse(datos[6].value));
        if (datos[7]?.value) setHorasPersonalizadas(JSON.parse(datos[7].value));
        if (datos[8]?.value) setEventosCalendario(JSON.parse(datos[8].value));
        if (datos[9]?.value) setNotasPlanner(JSON.parse(datos[9].value));
      });
    } catch (err) {
      console.error('Error cargando datos:', err);
    }
  };

  const guardar = async (clave, valor) => {
    try {
      const dato = typeof valor === 'string' ? valor : JSON.stringify(valor);
      await window.storage.set(clave, dato);
    } catch (err) {
      console.error('Error guardando:', err);
    }
  };

  const irInicio = () => {
    setPantalla('inicio');
    setIdEscuela(null);
    setIdMateria(null);
    setIdCurso(null);
    setIdAlumno(null);
  };

  // PANTALLA DE CARGA
  if (cargandoAuth) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center">
        <div className="text-center">
          <div className="spinner mb-4"></div>
          <p className="text-gray-600">Cargando...</p>
        </div>
      </div>
    );
  }
    // PANTALLA DE LOGIN/REGISTRO
  if (!usuario) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center p-4">
        <div className="max-w-md w-full">
          <div className="bg-white rounded-2xl shadow-2xl p-8">
            <div className="text-center mb-8">
              <div className="bg-blue-100 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
                <School className="w-10 h-10 text-blue-600" />
              </div>
              <h1 className="text-3xl font-bold text-gray-800 mb-2">Agenda Docente</h1>
              <p className="text-gray-600 flex items-center justify-center gap-2">
                <Cloud className="w-5 h-5" />
                Tus datos seguros en la nube
              </p>
            </div>

            {pantallaAuth === 'login' ? (
              <form onSubmit={handleLogin} className="space-y-4">
                <h2 className="text-xl font-bold text-center mb-4">Iniciar Sesi√≥n</h2>
                
                {errorAuth && (
                  <div className="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm">
                    {errorAuth}
                  </div>
                )}

                <div>
                  <label className="block text-sm font-semibold mb-2 flex items-center gap-2">
                    <Mail className="w-4 h-4" />
                    Email
                  </label>
                  <input
                    type="email"
                    value={email}
                    onChange={(e) => setEmail(e.target.value)}
                    placeholder="tu@email.com"
                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    required
                  />
                </div>

                <div>
                  <label className="block text-sm font-semibold mb-2 flex items-center gap-2">
                    <Lock className="w-4 h-4" />
                    Contrase√±a
                  </label>
                  <input
                    type="password"
                    value={password}
                    onChange={(e) => setPassword(e.target.value)}
                    placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    required
                  />
                </div>

                <button
                  type="submit"
                  className="w-full bg-blue-600 text-white p-3 rounded-lg font-semibold hover:bg-blue-700 transition flex items-center justify-center gap-2">
                  Iniciar Sesi√≥n
                </button>

                <button
                  type="button"
                  onClick={() => {
                    setPantallaAuth('register');
                    setErrorAuth('');
                  }}
                  className="w-full text-blue-600 text-sm hover:underline font-semibold">
                  ¬øNo tienes cuenta? Reg√≠strate
                </button>
              </form>
            ) : (
              <form onSubmit={handleRegister} className="space-y-4">
                <h2 className="text-xl font-bold text-center mb-4">Crear Cuenta</h2>

                {errorAuth && (
                  <div className="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm">
                    {errorAuth}
                  </div>
                )}

                <div>
                  <label className="block text-sm font-semibold mb-2 flex items-center gap-2">
                    <Mail className="w-4 h-4" />
                    Email
                  </label>
                  <input
                    type="email"
                    value={email}
                    onChange={(e) => setEmail(e.target.value)}
                    placeholder="tu@email.com"
                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                    required
                  />
                </div>

                <div>
                  <label className="block text-sm font-semibold mb-2 flex items-center gap-2">
                    <Lock className="w-4 h-4" />
                    Contrase√±a
                  </label>
                  <input
                    type="password"
                    value={password}
                    onChange={(e) => setPassword(e.target.value)}
                    placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                    minLength="6"
                    required
                  />
                  <p className="text-xs text-gray-500 mt-1">M√≠nimo 6 caracteres</p>
                </div>

                <button
                  type="submit"
                  className="w-full bg-green-600 text-white p-3 rounded-lg font-semibold hover:bg-green-700 transition flex items-center justify-center gap-2">
                  Crear Cuenta
                </button>

                <button
                  type="button"
                  onClick={() => {
                    setPantallaAuth('login');
                    setErrorAuth('');
                  }}
                  className="w-full text-blue-600 text-sm hover:underline font-semibold">
                  ¬øYa tienes cuenta? Inicia sesi√≥n
                </button>
              </form>
            )}
          </div>
        </div>
      </div>
    );
  }

  // RENDERIZADO SEG√öN PANTALLA
  switch(pantalla) {
          case 'inicio':
      return (
        <div className="min-h-screen bg-gray-50 p-4">
          <div className="max-w-2xl mx-auto space-y-4">
            <div className={`bg-gradient-to-r ${col.g} text-white p-6 rounded-lg shadow-lg`}>
              <div className="flex justify-between items-start mb-2">
                <h1 className="text-3xl font-bold">Agenda Docente</h1>
                <button
                  onClick={handleLogout}
                  className="bg-white bg-opacity-20 hover:bg-opacity-30 p-2 rounded-lg transition"
                  title="Cerrar sesi√≥n">
                  <LogOut className="w-5 h-5" />
                </button>
              </div>
              
              <div className="flex items-center gap-2">
                {!editandoNombre ? (
                  <>
                    <p className="text-xl flex-1">
                      Prof. {docente || 'Sin nombre'}
                    </p>
                    <button
                      onClick={() => setEditandoNombre(true)}
                      className="bg-white bg-opacity-20 hover:bg-opacity-30 p-2 rounded-lg transition"
                      title="Editar nombre">
                      <Edit2 className="w-4 h-4" />
                    </button>
                  </>
                ) : (
                  <div className="flex gap-2 w-full">
                    <input
                      type="text"
                      value={docente}
                      onChange={(e) => setDocente(e.target.value)}
                      placeholder="Tu nombre"
                      className="flex-1 p-2 rounded text-gray-800"
                      autoFocus
                    />
                    <button
                      onClick={() => {
                        if (docente.trim()) {
                          guardar('docente', docente);
                          setEditandoNombre(false);
                        }
                      }}
                      className="bg-green-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-green-700">
                      Guardar
                    </button>
                  </div>
                )}
              </div>

              <div className="mt-3 flex items-center gap-2 text-sm opacity-90">
                <Cloud className="w-4 h-4" />
                <span>Sincronizado en la nube</span>
              </div>
            </div>

            <button
              onClick={() => setPantalla('planner-mensual')}
              className="w-full bg-white p-6 rounded-lg shadow hover:shadow-md flex items-center justify-center gap-3">
              <Calendar className={`w-10 h-10 ${col.t}`} />
              <span className="text-xl font-semibold">Planner Mensual</span>
            </button>

            <button
              onClick={() => setPantalla('lista-escuelas')}
              className="w-full bg-white p-6 rounded-lg shadow hover:shadow-md flex items-center justify-center gap-3">
              <School className={`w-10 h-10 ${col.t}`} />
              <span className="text-xl font-semibold">Mis Escuelas</span>
            </button>

            <button
              onClick={() => setPantalla('config-tema')}
              className="w-full bg-white p-4 rounded-lg shadow hover:shadow-md flex items-center justify-center gap-2">
              <Palette className="w-6 h-6" />
              <span>Cambiar Tema</span>
            </button>
          </div>
        </div>
      );

    case 'config-tema':
      return (
        <div className="min-h-screen bg-gray-50 p-4">
          <div className="max-w-2xl mx-auto">
            <div className="flex items-center gap-4 mb-6">
              <button onClick={irInicio} className="p-2 hover:bg-gray-100 rounded">
                <ArrowLeft className="w-6 h-6" />
              </button>
              <h2 className="text-2xl font-bold">Configurar Tema</h2>
            </div>

            <div className="space-y-3">
              {Object.entries(colores).map(([clave, datos]) => (
                <button
                  key={clave}
                  onClick={() => {
                    setTema(clave);
                    guardar('tema', clave);
                  }}
                  className={`w-full p-4 rounded-lg shadow flex items-center gap-3 ${tema === clave ? 'ring-4 ring-offset-2' : ''}`}>
                  <div className={`w-12 h-12 rounded ${datos.p}`}></div>
                  <span className="text-xl font-semibold">{datos.n}</span>
                  {tema === clave && <Check className="w-6 h-6 ml-auto text-green-600" />}
                </button>
              ))}
            </div>
          </div>
        </div>
      );

    case 'lista-escuelas':
      return (
        <div className="min-h-screen bg-gray-50 p-4">
          <div className="max-w-2xl mx-auto">
            <div className="flex items-center gap-4 mb-6">
              <button onClick={irInicio} className="p-2 hover:bg-gray-100 rounded">
                <ArrowLeft className="w-6 h-6" />
              </button>
              <h2 className="text-2xl font-bold">Escuelas</h2>
            </div>

            <div className="bg-white p-4 rounded-lg shadow mb-4 flex gap-2">
              <input
                type="text"
                value={textoEscuela}
                onChange={(e) => setTextoEscuela(e.target.value)}
                placeholder="Nueva escuela"
                className="flex-1 p-3 border rounded-lg"
              />
              <button
                onClick={() => {
                  if (textoEscuela.trim()) {
                    const nuevas = [...escuelas, { id: Date.now(), nombre: textoEscuela }];
                    setEscuelas(nuevas);
                    guardar('escuelas', nuevas);
                    setTextoEscuela('');
                  }
                }}
                className="bg-green-600 text-white p-3 rounded-lg">
                <Plus className="w-5 h-5" />
              </button>
            </div>

            <div className="space-y-2">
              {escuelas.map(esc => (
                <div key={esc.id} className="bg-white p-4 rounded-lg shadow flex justify-between items-center">
                  <button
                    onClick={() => {
                      setIdEscuela(esc.id);
                      setPantalla('menu-escuela');
                    }}
                    className="flex-1 text-left font-semibold">
                    {esc.nombre}
                  </button>
                  <button
                    onClick={() => {
                      if (window.confirm('¬øEliminar?')) {
                        const filtradas = escuelas.filter(e => e.id !== esc.id);
                        setEscuelas(filtradas);
                        guardar('escuelas', filtradas);
                      }
                    }}
                    className="text-red-600 p-2">
                    <Trash2 className="w-5 h-5" />
                  </button>
                </div>
              ))}
            </div>
          </div>
        </div>
      );

    case 'menu-escuela':
      const esc = escuelas.find(e => e.id === idEscuela);
      return (
        <div className="min-h-screen bg-gray-50 p-4">
          <div className="max-w-2xl mx-auto">
            <div className="flex items-center gap-4 mb-6">
              <button
                onClick={() => {
                  setPantalla('lista-escuelas');
                  setIdEscuela(null);
                }}
                className="p-2 hover:bg-gray-100 rounded">
                <ArrowLeft className="w-6 h-6" />
              </button>
              <h2 className="text-2xl font-bold">{esc?.nombre || 'Escuela'}</h2>
            </div>

            <div className="space-y-4">
              <button
                onClick={() => setPantalla('horarios')}
                className="w-full bg-white p-6 rounded-lg shadow hover:shadow-md flex items-center justify-center gap-3">
                <Clock className="w-10 h-10 text-purple-600" />
                <span className="text-xl font-semibold">Horarios</span>
              </button>

              <button
                onClick={() => setPantalla('lista-materias')}
                className="w-full bg-white p-6 rounded-lg shadow hover:shadow-md flex items-center justify-center gap-3">
                <BookOpen className="w-10 h-10 text-green-600" />
                <span className="text-xl font-semibold">Materias</span>
              </button>
            </div>
          </div>
        </div>
      );
          case 'horarios':
      const escHorario = escuelas.find(e => e.id === idEscuela);
      const dias = ['Lunes', 'Martes', 'Mi√©rcoles', 'Jueves', 'Viernes'];
      const numerosHora = [1, 2, 3, 4, 5, 6, 7, 8];
      const claveHorario = `horario-${idEscuela}`;
      const claveRangos = `rangos-${idEscuela}`;
      const datosHorario = horarios[claveHorario] || {};
      const rangosHorarios = horasPersonalizadas[claveRangos] || {};

      if (editandoRangoHora) {
        return (
          <div className="min-h-screen bg-gray-50 p-4">
            <div className="max-w-2xl mx-auto">
              <div className="flex items-center gap-4 mb-6">
                <button
                  onClick={() => {
                    setEditandoRangoHora(null);
                    setRangoHorario('');
                  }}
                  className="p-2 hover:bg-gray-100 rounded">
                  <ArrowLeft className="w-6 h-6" />
                </button>
                <div>
                  <h2 className="text-xl font-bold">Configurar Hora {editandoRangoHora}</h2>
                  <p className="text-sm text-gray-600">Ingresa el rango horario</p>
                </div>
              </div>

              <div className="bg-white p-4 rounded-lg shadow space-y-3">
                <div>
                  <label className="block mb-1 font-semibold text-sm">Rango Horario (Ej: 13:20 - 14:00)</label>
                  <input
                    type="text"
                    value={rangoHorario}
                    onChange={(e) => setRangoHorario(e.target.value)}
                    placeholder="13:20 - 14:00"
                    className="w-full p-3 border rounded-lg"
                    autoFocus
                  />
                  <p className="text-xs text-gray-500 mt-1">40 minutos por hora m√≥dulo</p>
                </div>

                <div className="flex gap-2">
                  <button
                    onClick={() => {
                      if (rangoHorario.trim()) {
                        const nuevos = { ...horasPersonalizadas, [claveRangos]: { ...rangosHorarios, [editandoRangoHora]: rangoHorario } };
                        setHorasPersonalizadas(nuevos);
                        guardar('horasPersonalizadas', nuevos);
                        setEditandoRangoHora(null);
                        setRangoHorario('');
                      }
                    }}
                    className={`flex-1 ${col.p} text-white p-3 rounded-lg font-semibold`}>
                    Guardar
                  </button>
                  <button
                    onClick={() => {
                      const { [editandoRangoHora]: _, ...resto } = rangosHorarios;
                      const nuevos = { ...horasPersonalizadas, [claveRangos]: resto };
                      setHorasPersonalizadas(nuevos);
                      guardar('horasPersonalizadas', nuevos);
                      setEditandoRangoHora(null);
                      setRangoHorario('');
                    }}
                    className="px-6 bg-red-600 text-white p-3 rounded-lg font-semibold">
                    Borrar
                  </button>
                </div>
              </div>
            </div>
          </div>
        );
      }

      if (editandoHorario) {
        return (
          <div className="min-h-screen bg-gray-50 p-4">
            <div className="max-w-2xl mx-auto">
              <div className="flex items-center gap-4 mb-6">
                <button
                  onClick={() => {
                    setEditandoHorario(null);
                    setTextoHorario('');
                  }}
                  className="p-2 hover:bg-gray-100 rounded">
                  <ArrowLeft className="w-6 h-6" />
                </button>
                <div>
                  <h2 className="text-xl font-bold">Editar Materia</h2>
                  <p className="text-sm text-gray-600">{editandoHorario.dia} - Hora {editandoHorario.hora}</p>
                </div>
              </div>

              <div className="bg-white p-4 rounded-lg shadow space-y-3">
                <div>
                  <label className="block mb-1 font-semibold text-sm">Materia/Actividad</label>
                  <input
                    type="text"
                    value={textoHorario}
                    onChange={(e) => setTextoHorario(e.target.value)}
                    placeholder="Ej: Matem√°tica - 1¬∞ A"
                    className="w-full p-3 border rounded-lg"
                    autoFocus
                  />
                </div>

                <div className="flex gap-2">
                  <button
                    onClick={() => {
                      const clave = `${editandoHorario.dia}-${editandoHorario.hora}`;
                      const nuevos = { ...horarios, [claveHorario]: { ...datosHorario, [clave]: textoHorario } };
                      setHorarios(nuevos);
                      guardar('horarios', nuevos);
                      setEditandoHorario(null);
                      setTextoHorario('');
                    }}
                    className={`flex-1 ${col.p} text-white p-3 rounded-lg font-semibold`}>
                    Guardar
                  </button>
                  <button
                    onClick={() => {
                      const clave = `${editandoHorario.dia}-${editandoHorario.hora}`;
                      const { [clave]: _, ...resto } = datosHorario;
                      const nuevos = { ...horarios, [claveHorario]: resto };
                      setHorarios(nuevos);
                      guardar('horarios', nuevos);
                      setEditandoHorario(null);
                      setTextoHorario('');
                    }}
                    className="px-6 bg-red-600 text-white p-3 rounded-lg font-semibold">
                    Borrar
                  </button>
                </div>
              </div>
            </div>
          </div>
        );
      }

      return (
        <div className="min-h-screen bg-gray-50 p-4">
          <div className="max-w-5xl mx-auto">
            <div className="flex items-center gap-4 mb-6">
              <button onClick={() => setPantalla('menu-escuela')} className="p-2 hover:bg-gray-100 rounded">
                <ArrowLeft className="w-6 h-6" />
              </button>
              <h2 className="text-2xl font-bold">Horarios - {escHorario?.nombre || ''}</h2>
            </div>

            <div className="bg-white rounded-lg shadow overflow-x-auto mb-4">
              <table className="w-full text-sm">
                <thead className={`${col.p} text-white`}>
                  <tr>
                    <th className="p-3 text-center">Hora</th>
                    <th className="p-3 text-center">Horario</th>
                    {dias.map((dia, idx) => {
                      const hoy = new Date().getDay();
                      const diaNumero = idx + 1;
                      const esHoy = hoy === diaNumero;
                      return (
                        <th key={dia} className={`p-3 text-center ${esHoy ? 'bg-yellow-400' : ''}`}>
                          {dia}
                          {esHoy && <div className="text-xs font-normal">HOY</div>}
                        </th>
                      );
                    })}
                  </tr>
                </thead>
                <tbody>
                  {numerosHora.map(numHora => {
                    const rangoHora = rangosHorarios[numHora];
                    const hoy = new Date().getDay();
                    return (
                      <tr key={numHora} className="border-b">
                        <td className="p-3 text-center font-bold text-lg">{numHora}</td>
                        <td
                          onClick={() => {
                            setEditandoRangoHora(numHora);
                            setRangoHorario(rangoHora || '');
                          }}
                          className="p-3 text-center cursor-pointer hover:bg-gray-100 transition">
                          {rangoHora ? (
                            <div className="text-xs font-semibold text-gray-700">{rangoHora}</div>
                          ) : (
                            <div className="text-gray-400 text-xs">Click para configurar</div>
                          )}
                        </td>
                        {dias.map((dia, idx) => {
                          const diaNumero = idx + 1;
                          const esHoy = hoy === diaNumero;
                          const clave = `${dia}-${numHora}`;
                          const contenido = datosHorario[clave];
                          return (
                            <td
                              key={clave}
                              onClick={() => {
                                setEditandoHorario({ dia, hora: numHora });
                                setTextoHorario(contenido || '');
                              }}
                              className={`p-2 text-center cursor-pointer hover:bg-gray-100 transition ${esHoy ? 'bg-yellow-50' : ''}`}>
                              {contenido ? (
                                <div className={`${esHoy ? 'bg-yellow-200' : col.s} p-2 rounded text-xs font-semibold ${esHoy ? 'text-yellow-900' : col.t}`}>
                                  {contenido}
                                </div>
                              ) : (
                                <div className="text-gray-400 text-xs">+</div>
                              )}
                            </td>
                          );
                        })}
                      </tr>
                    );
                  })}
                </tbody>
              </table>
            </div>

            <div className="bg-blue-50 border-l-4 border-blue-500 p-4 rounded">
              <p className="text-sm text-blue-800 mb-2">
                <strong>üí° C√≥mo usar:</strong>
              </p>
              <ul className="text-sm text-blue-800 space-y-1 ml-4">
                <li>‚Ä¢ <strong>Paso 1:</strong> Haz clic en "Horario" para configurar cada rango (Ej: 13:20 - 14:00)</li>
                <li>‚Ä¢ <strong>Paso 2:</strong> Luego haz clic en cada celda de d√≠a para agregar materias</li>
                <li>‚Ä¢ Cada hora m√≥dulo = 40 minutos</li>
                <li>‚Ä¢ La columna amarilla indica el d√≠a de hoy</li>
              </ul>
            </div>
          </div>
        </div>
      );
          case 'lista-materias':
      const escMaterias = escuelas.find(e => e.id === idEscuela);
      const listaMaterias = materias[idEscuela] || [];
      return (
        <div className="min-h-screen bg-gray-50 p-4">
          <div className="max-w-2xl mx-auto">
            <div className="flex items-center gap-4 mb-6">
              <button onClick={() => setPantalla('menu-escuela')} className="p-2 hover:bg-gray-100 rounded">
                <ArrowLeft className="w-6 h-6" />
              </button>
              <h2 className="text-2xl font-bold">Materias - {escMaterias?.nombre || ''}</h2>
            </div>

            <div className="bg-white p-4 rounded-lg shadow mb-4 flex gap-2">
              <input
                type="text"
                value={textoMateria}
                onChange={(e) => setTextoMateria(e.target.value)}
                placeholder="Nueva materia"
                className="flex-1 p-3 border rounded-lg"
              />
              <button
                onClick={() => {
                  if (textoMateria.trim()) {
                    const nuevas = { ...materias, [idEscuela]: [...listaMaterias, { id: Date.now(), nombre: textoMateria }] };
                    setMaterias(nuevas);
                    guardar('materias', nuevas);
                    setTextoMateria('');
                  }
                }}
                className="bg-green-600 text-white p-3 rounded-lg">
                <Plus className="w-5 h-5" />
              </button>
            </div>

            <div className="space-y-2">
              {listaMaterias.map(mat => (
                <div key={mat.id} className="bg-white p-4 rounded-lg shadow flex justify-between items-center">
                  <button
                    onClick={() => {
                      setIdMateria(mat.id);
                      setPantalla('menu-materia');
                    }}
                    className="flex-1 text-left font-semibold">
                    {mat.nombre}
                  </button>
                  <button
                    onClick={() => {
                      if (window.confirm('¬øEliminar?')) {
                        const filtradas = listaMaterias.filter(m => m.id !== mat.id);
                        const nuevas = { ...materias, [idEscuela]: filtradas };
                        setMaterias(nuevas);
                        guardar('materias', nuevas);
                      }
                    }}
                    className="text-red-600 p-2">
                    <Trash2 className="w-5 h-5" />
                  </button>
                </div>
              ))}
            </div>
          </div>
        </div>
      );

    case 'menu-materia':
      const escMateria = escuelas.find(e => e.id === idEscuela);
      const listaMats = materias[idEscuela] || [];
      const materia = listaMats.find(m => m.id === idMateria);
      return (
        <div className="min-h-screen bg-gray-50 p-4">
          <div className="max-w-2xl mx-auto">
            <div className="flex items-center gap-4 mb-6">
              <button
                onClick={() => {
                  setPantalla('lista-materias');
                  setIdMateria(null);
                }}
                className="p-2 hover:bg-gray-100 rounded">
                <ArrowLeft className="w-6 h-6" />
              </button>
              <div>
                <h2 className="text-2xl font-bold">{materia?.nombre || 'Materia'}</h2>
                <p className="text-sm text-gray-600">{escMateria?.nombre || ''}</p>
              </div>
            </div>

            <div className="grid grid-cols-2 gap-4">
              <button
                onClick={() => setPantalla('cursos')}
                className="bg-white p-6 rounded-lg shadow hover:shadow-md flex flex-col items-center gap-2">
                <Users className="w-8 h-8 text-blue-600" />
                <span className="font-semibold">Cursos</span>
              </button>

              <button
                onClick={() => setPantalla('asistencia')}
                className="bg-white p-6 rounded-lg shadow hover:shadow-md flex flex-col items-center gap-2">
                <ClipboardList className="w-8 h-8 text-red-600" />
                <span className="font-semibold">Asistencia</span>
              </button>

              <button
                onClick={() => setPantalla('notas')}
                className="bg-white p-6 rounded-lg shadow hover:shadow-md flex flex-col items-center gap-2">
                <Calendar className="w-8 h-8 text-indigo-600" />
                <span className="font-semibold">Notas</span>
              </button>

              <button
                onClick={() => setPantalla('libro')}
                className="bg-white p-6 rounded-lg shadow hover:shadow-md flex flex-col items-center gap-2">
                <FileText className="w-8 h-8 text-teal-600" />
                <span className="font-semibold">Libro Temas</span>
              </button>
            </div>
          </div>
        </div>
      );

    case 'cursos':
      const claveCursos = `${idEscuela}-${idMateria}`;
      const listaCursos = cursos[claveCursos] || [];

      if (!idCurso) {
        return (
          <div className="min-h-screen bg-gray-50 p-4">
            <div className="max-w-2xl mx-auto">
              <div className="flex items-center gap-4 mb-6">
                <button onClick={() => setPantalla('menu-materia')} className="p-2 hover:bg-gray-100 rounded">
                  <ArrowLeft className="w-6 h-6" />
                </button>
                <h2 className="text-2xl font-bold">Cursos</h2>
              </div>

              <div className="bg-white p-4 rounded-lg shadow mb-4 flex gap-2">
                <input
                  type="text"
                  value={textoCurso}
                  onChange={(e) => setTextoCurso(e.target.value)}
                  placeholder="Ej: 1¬∞ A"
                  className="flex-1 p-3 border rounded-lg"
                />
                <button
                  onClick={() => {
                    if (textoCurso.trim()) {
                      const nuevos = { ...cursos, [claveCursos]: [...listaCursos, { id: Date.now(), nombre: textoCurso }] };
                      setCursos(nuevos);
                      guardar('cursos', nuevos);
                      setTextoCurso('');
                    }
                  }}
                  className="bg-green-600 text-white p-3 rounded-lg">
                  <Plus className="w-5 h-5" />
                </button>
              </div>

              <div className="space-y-2">
                {listaCursos.map(cur => (
                  <div key={cur.id} className="bg-white p-4 rounded-lg shadow flex justify-between items-center">
                    <button
                      onClick={() => setIdCurso(cur.id)}
                      className="flex-1 text-left font-semibold">
                      {cur.nombre}
                    </button>
                    <button
                      onClick={() => {
                        if (window.confirm('¬øEliminar curso?')) {
                          const filtrados = listaCursos.filter(c => c.id !== cur.id);
                          const nuevos = { ...cursos, [claveCursos]: filtrados };
                          setCursos(nuevos);
                          guardar('cursos', nuevos);
                        }
                      }}
                      className="text-red-600 p-2">
                      <Trash2 className="w-5 h-5" />
                    </button>
                  </div>
                ))}
              </div>
            </div>
          </div>
        );
      }

      const curso = listaCursos.find(c => c.id === idCurso);
      const claveAlumnos = `${claveCursos}-${idCurso}`;
      const listaAlumnos = alumnos[claveAlumnos] || [];

      return (
        <div className="min-h-screen bg-gray-50 p-4">
          <div className="max-w-2xl mx-auto">
            <div className="flex items-center gap-4 mb-6">
              <button onClick={() => setIdCurso(null)} className="p-2 hover:bg-gray-100 rounded">
                <ArrowLeft className="w-6 h-6" />
              </button>
              <h2 className="text-xl font-bold">Alumnos - {curso?.nombre || ''}</h2>
            </div>

            <div className="bg-white p-4 rounded-lg shadow mb-4 flex gap-2">
              <input
                type="text"
                value={textoAlumno}
                onChange={(e) => setTextoAlumno(e.target.value)}
                placeholder="Nombre alumno"
                className="flex-1 p-3 border rounded-lg"
              />
              <button
                onClick={() => {
                  if (textoAlumno.trim()) {
                    const nuevos = { ...alumnos, [claveAlumnos]: [...listaAlumnos, { id: Date.now(), nombre: textoAlumno }] };
                    setAlumnos(nuevos);
                    guardar('alumnos', nuevos);
                    setTextoAlumno('');
                  }
                }}
                className="bg-green-600 text-white p-3 rounded-lg">
                <Plus className="w-5 h-5" />
              </button>
            </div>

            <div className="space-y-2">
              {listaAlumnos.map(alu => (
                <div key={alu.id} className="bg-white p-4 rounded-lg shadow flex justify-between items-center">
                  <span className="font-semibold">{alu.nombre}</span>
                  <button
                    onClick={() => {
                      const filtrados = listaAlumnos.filter(a => a.id !== alu.id);
                      const nuevos = { ...alumnos, [claveAlumnos]: filtrados };
                      setAlumnos(nuevos);
                      guardar('alumnos', nuevos);
                    }}
                    className="text-red-600 p-2">
                    <Trash2 className="w-5 h-5" />
                  </button>
                </div>
              ))}
            </div>
          </div>
        </div>
      );
          case 'asistencia':
      const claveAsistCursos = `${idEscuela}-${idMateria}`;
      const listaCursosAsist = cursos[claveAsistCursos] || [];

      if (!idCurso) {
        return (
          <div className="min-h-screen bg-gray-50 p-4">
            <div className="max-w-2xl mx-auto">
              <div className="flex items-center gap-4 mb-6">
                <button onClick={() => setPantalla('menu-materia')} className="p-2 hover:bg-gray-100 rounded">
                  <ArrowLeft className="w-6 h-6" />
                </button>
                <h2 className="text-2xl font-bold">Asistencia - Seleccionar Curso</h2>
              </div>

              <div className="space-y-2">
                {listaCursosAsist.map(cur => (
                  <button
                    key={cur.id}
                    onClick={() => setIdCurso(cur.id)}
                    className="w-full bg-white p-4 rounded-lg shadow hover:shadow-md text-left font-semibold">
                    {cur.nombre}
                  </button>
                ))}
              </div>
            </div>
          </div>
        );
      }

      const cursoAsist = listaCursosAsist.find(c => c.id === idCurso);
      const claveAlumnosAsist = `${claveAsistCursos}-${idCurso}`;
      const listaAlumnosAsist = alumnos[claveAlumnosAsist] || [];

      if (!idAlumno) {
        const calcularAsistencia = (aid) => {
          const registros = Object.entries(asistencias).filter(([k]) => k.startsWith(`${claveAlumnosAsist}-${aid}-`));
          const total = registros.length;
          const presentes = registros.filter(([, v]) => v === 'P').length;
          const porc = total > 0 ? (presentes / total) * 100 : 100;
          return { total, presentes, ausentes: total - presentes, porc };
        };

        const getColor = (p) => {
          if (p < 50) return 'bg-red-100 border-red-500';
          if (p < 75) return 'bg-orange-100 border-orange-500';
          return 'bg-blue-100 border-blue-500';
        };

        return (
          <div className="min-h-screen bg-gray-50 p-4">
            <div className="max-w-2xl mx-auto">
              <div className="flex items-center gap-4 mb-6">
                <button onClick={() => setIdCurso(null)} className="p-2 hover:bg-gray-100 rounded">
                  <ArrowLeft className="w-6 h-6" />
                </button>
                <h2 className="text-xl font-bold">Asistencia - {cursoAsist?.nombre || ''}</h2>
              </div>

              <div className="space-y-2">
                {listaAlumnosAsist.map(alu => {
                  const stats = calcularAsistencia(alu.id);
                  return (
                    <button
                      key={alu.id}
                      onClick={() => setIdAlumno(alu.id)}
                      className={`w-full p-4 rounded-lg shadow border-2 text-left ${getColor(stats.porc)}`}>
                      <div className="flex justify-between items-center">
                        <span className="font-semibold">{alu.nombre}</span>
                        <span className="text-sm">
                          {stats.porc.toFixed(0)}% | P:{stats.presentes} A:{stats.ausentes}
                        </span>
                      </div>
                    </button>
                  );
                })}
              </div>
            </div>
          </div>
        );
      }

      const alumnoAsist = listaAlumnosAsist.find(a => a.id === idAlumno);
      const registrosAsist = Object.entries(asistencias)
        .filter(([k]) => k.startsWith(`${claveAlumnosAsist}-${idAlumno}-`))
        .map(([k, v]) => ({
          fecha: k.split('-').pop(),
          estado: v
        }))
        .sort((a, b) => b.fecha.localeCompare(a.fecha));

      return (
        <div className="min-h-screen bg-gray-50 p-4">
          <div className="max-w-2xl mx-auto">
            <div className="flex items-center gap-4 mb-6">
              <button onClick={() => setIdAlumno(null)} className="p-2 hover:bg-gray-100 rounded">
                <ArrowLeft className="w-6 h-6" />
              </button>
              <h2 className="text-xl font-bold">{alumnoAsist?.nombre || ''}</h2>
            </div>

            <div className="bg-white p-4 rounded-lg shadow space-y-3 mb-4">
              <div>
                <label className="block mb-1 font-semibold text-sm">Fecha</label>
                <input
                  type="date"
                  value={fechaAsist}
                  onChange={(e) => setFechaAsist(e.target.value)}
                  className="w-full p-2 border rounded-lg"
                />
              </div>

              <div className="flex gap-2">
                <button
                  onClick={() => setEstadoAsist('P')}
                  className={`flex-1 p-3 rounded-lg font-semibold ${estadoAsist === 'P' ? 'bg-green-600 text-white' : 'bg-gray-200'}`}>
                  Presente
                </button>
                <button
                  onClick={() => setEstadoAsist('A')}
                  className={`flex-1 p-3 rounded-lg font-semibold ${estadoAsist === 'A' ? 'bg-red-600 text-white' : 'bg-gray-200'}`}>
                  Ausente
                </button>
              </div>

              <button
                onClick={() => {
                  if (!fechaAsist || !estadoAsist) {
                    alert('Selecciona fecha y estado');
                    return;
                  }
                  const k = `${claveAlumnosAsist}-${idAlumno}-${fechaAsist}`;
                  const nuevas = { ...asistencias, [k]: estadoAsist };
                  setAsistencias(nuevas);
                  guardar('asistencias', nuevas);
                  setFechaAsist('');
                  setEstadoAsist('');
                }}
                className={`w-full ${col.p} text-white p-3 rounded-lg font-semibold`}>
                Guardar Asistencia
              </button>
            </div>

            <div className="bg-white p-4 rounded-lg shadow">
              <h3 className="font-bold mb-3">Historial</h3>
              <div className="space-y-2">
                {registrosAsist.map((reg, idx) => (
                  <div key={idx} className={`p-3 rounded-lg flex justify-between items-center ${reg.estado === 'P' ? 'bg-green-100' : 'bg-red-100'}`}>
                    <span className="font-semibold">{reg.fecha}</span>
                    <span className={`px-3 py-1 rounded ${reg.estado === 'P' ? 'bg-green-600' : 'bg-red-600'} text-white text-sm`}>
                      {reg.estado === 'P' ? 'Presente' : 'Ausente'}
                    </span>
                  </div>
                ))}
                {registrosAsist.length === 0 && (
                  <p className="text-gray-400 text-sm">No hay registros</p>
                )}
              </div>
            </div>
          </div>
        </div>
      );
          case 'notas':
      const claveNotasCursos = `${idEscuela}-${idMateria}`;
      const listaCursosNotas = cursos[claveNotasCursos] || [];

      if (!idCurso) {
        return (
          <div className="min-h-screen bg-gray-50 p-4">
            <div className="max-w-2xl mx-auto">
              <div className="flex items-center gap-4 mb-6">
                <button onClick={() => setPantalla('menu-materia')} className="p-2 hover:bg-gray-100 rounded">
                  <ArrowLeft className="w-6 h-6" />
                </button>
                <h2 className="text-2xl font-bold">Notas - Seleccionar Curso</h2>
              </div>

              <div className="space-y-2">
                {listaCursosNotas.map(cur => (
                  <button
                    key={cur.id}
                    onClick={() => setIdCurso(cur.id)}
                    className="w-full bg-white p-4 rounded-lg shadow hover:shadow-md text-left font-semibold">
                    {cur.nombre}
                  </button>
                ))}
              </div>
            </div>
          </div>
        );
      }

      const cursoNotas = listaCursosNotas.find(c => c.id === idCurso);
      const claveAlumnosNotas = `${claveNotasCursos}-${idCurso}`;
      const listaAlumnosNotas = alumnos[claveAlumnosNotas] || [];

      if (!idAlumno) {
        // ‚úÖ CORRECCI√ìN 6: PROMEDIO TRUNCADO A 2 DECIMALES (NO REDONDEADO)
        const calcularPromedio = (aid) => {
          const notasAlumno = Object.entries(notas)
            .filter(([k]) => k.startsWith(`${claveAlumnosNotas}-${aid}-`))
            .map(([, v]) => parseFloat(v.valor));
          if (notasAlumno.length === 0) return '-';
          const prom = notasAlumno.reduce((a, b) => a + b, 0) / notasAlumno.length;
          return truncarA2Decimales(prom).toFixed(2);
        };

        return (
          <div className="min-h-screen bg-gray-50 p-4">
            <div className="max-w-2xl mx-auto">
              <div className="flex items-center gap-4 mb-6">
                <button onClick={() => setIdCurso(null)} className="p-2 hover:bg-gray-100 rounded">
                  <ArrowLeft className="w-6 h-6" />
                </button>
                <h2 className="text-xl font-bold">Notas - {cursoNotas?.nombre || ''}</h2>
              </div>

              <div className="space-y-2">
                {listaAlumnosNotas.map(alu => {
                  const prom = calcularPromedio(alu.id);
                  return (
                    <button
                      key={alu.id}
                      onClick={() => setIdAlumno(alu.id)}
                      className="w-full bg-white p-4 rounded-lg shadow hover:shadow-md flex justify-between items-center">
                      <span className="font-semibold">{alu.nombre}</span>
                      <span className={`text-lg font-bold ${obtenerColorNota(prom)}`}>
                        Promedio: {prom}
                      </span>
                    </button>
                  );
                })}
              </div>
            </div>
          </div>
        );
      }

      const alumnoNotas = listaAlumnosNotas.find(a => a.id === idAlumno);
      const notasAlumno = Object.entries(notas)
        .filter(([k]) => k.startsWith(`${claveAlumnosNotas}-${idAlumno}-`))
        .map(([k, v]) => ({
          id: k,
          ...v
        }))
        .sort((a, b) => b.fecha.localeCompare(a.fecha));

      const tiposNotas = {
        tp: 'Trabajo Pr√°ctico',
        oral: 'Oral',
        escrita: 'Prueba Escrita',
        integ: 'Integradora',
        otro: 'Otro'
      };

      return (
        <div className="min-h-screen bg-gray-50 p-4">
          <div className="max-w-2xl mx-auto">
            <div className="flex items-center gap-4 mb-6">
              <button onClick={() => setIdAlumno(null)} className="p-2 hover:bg-gray-100 rounded">
                <ArrowLeft className="w-6 h-6" />
              </button>
              <h2 className="text-xl font-bold">{alumnoNotas?.nombre || ''}</h2>
            </div>

            <div className="bg-white p-4 rounded-lg shadow space-y-3 mb-4">
              <h3 className="font-bold">Agregar Nota</h3>

              <div className="grid grid-cols-2 gap-3">
                <div>
                  <label className="block mb-1 text-sm font-semibold">Trimestre</label>
                  <select
                    value={trimestreNota}
                    onChange={(e) => setTrimestreNota(e.target.value)}
                    className="w-full p-2 border rounded-lg">
                    <option value="1">1¬∞ Trimestre</option>
                    <option value="2">2¬∞ Trimestre</option>
                    <option value="3">3¬∞ Trimestre</option>
                  </select>
                </div>

                <div>
                  <label className="block mb-1 text-sm font-semibold">Tipo</label>
                  <select
                    value={tipoNota}
                    onChange={(e) => setTipoNota(e.target.value)}
                    className="w-full p-2 border rounded-lg">
                    {Object.entries(tiposNotas).map(([k, v]) => (
                      <option key={k} value={k}>{v}</option>
                    ))}
                  </select>
                </div>
              </div>

              <div>
                <label className="block mb-1 text-sm font-semibold">Descripci√≥n</label>
                <input
                  type="text"
                  value={descripcionNota}
                  onChange={(e) => setDescripcionNota(e.target.value)}
                  placeholder="Ej: TP N¬∞1 - Ecuaciones"
                  className="w-full p-2 border rounded-lg"
                />
              </div>

              <div className="grid grid-cols-2 gap-3">
                <div>
                  <label className="block mb-1 text-sm font-semibold">Nota (1-10)</label>
                  <input
                    type="number"
                    min="1"
                    max="10"
                    step="0.5"
                    value={valorNota}
                    onChange={(e) => setValorNota(e.target.value)}
                    className="w-full p-2 border rounded-lg"
                  />
                </div>

                <div>
                  <label className="block mb-1 text-sm font-semibold">Fecha</label>
                  <input
                    type="date"
                    value={fechaNota}
                    onChange={(e) => setFechaNota(e.target.value)}
                    className="w-full p-2 border rounded-lg"
                  />
                </div>
              </div>

              <button
                onClick={() => {
                  if (!valorNota || !fechaNota || !descripcionNota) {
                    alert('Completa todos los campos');
                    return;
                  }
                  const k = `${claveAlumnosNotas}-${idAlumno}-${Date.now()}`;
                  const nuevasNotas = {
                    ...notas,
                    [k]: {
                      trimestre: trimestreNota,
                      tipo: tipoNota,
                      valor: valorNota,
                      fecha: fechaNota,
                      descripcion: descripcionNota
                    }
                  };
                  setNotas(nuevasNotas);
                  guardar('notas', nuevasNotas);
                  setValorNota('');
                  setFechaNota('');
                  setDescripcionNota('');
                }}
                className={`w-full ${col.p} text-white p-3 rounded-lg font-semibold`}>
                Guardar Nota
              </button>
            </div>

            <div className="bg-white p-4 rounded-lg shadow">
              <h3 className="font-bold mb-3">Historial de Notas</h3>
              <div className="space-y-3">
                {['1', '2', '3'].map(trim => {
                  const notasTrim = notasAlumno.filter(n => n.trimestre === trim);
                  if (notasTrim.length === 0) return null;
                  
                  // ‚úÖ CORRECCI√ìN 7: TRUNCAR PROMEDIO POR TRIMESTRE (NO REDONDEAR)
                  const promTrim = truncarA2Decimales(
                    notasTrim.reduce((a, b) => a + parseFloat(b.valor), 0) / notasTrim.length
                  ).toFixed(2);

                  return (
                    <div key={trim} className="border rounded-lg p-3">
                      <div className="flex justify-between items-center mb-2">
                        <h4 className="font-bold text-sm">{trim}¬∞ Trimestre</h4>
                        <span className={`font-bold ${obtenerColorNota(promTrim)}`}>
                          Promedio: {promTrim}
                        </span>
                      </div>

                      <div className="space-y-2">
                        {notasTrim.map(nota => (
                          <div key={nota.id} className="bg-gray-50 p-2 rounded flex justify-between items-center">
                            <div className="flex-1">
                              <p className="font-semibold text-sm">{nota.descripcion}</p>
                              <p className="text-xs text-gray-600">{tiposNotas[nota.tipo]} - {nota.fecha}</p>
                            </div>
                            <div className="flex items-center gap-2">
                              <span className={`text-lg font-bold ${obtenerColorNota(nota.valor)}`}>
                                {nota.valor}
                              </span>
                              <button
                                onClick={() => {
                                  if (window.confirm('¬øEliminar nota?')) {
                                    const { [nota.id]: _, ...resto } = notas;
                                    setNotas(resto);
                                    guardar('notas', resto);
                                  }
                                }}
                                className="text-red-600 p-1">
                                <Trash2 className="w-4 h-4" />
                              </button>
                            </div>
                          </div>
                        ))}
                      </div>
                    </div>
                  );
                })}

                {/* ‚úÖ CORRECCI√ìN 8: NOTA FINAL TRUNCADA (NO REDONDEADA) */}
                {notasAlumno.length > 0 && (() => {
                  const promediosPorTrimestre = ['1', '2', '3'].map(trim => {
                    const notasTrim = notasAlumno.filter(n => n.trimestre === trim);
                    if (notasTrim.length === 0) return null;
                    return (notasTrim.reduce((a, b) => a + parseFloat(b.valor), 0) / notasTrim.length);
                  }).filter(p => p !== null);

                  if (promediosPorTrimestre.length >= 2) {
                    // ‚úÖ AQU√ç EST√Å LA CORRECCI√ìN PRINCIPAL: TRUNCAR, NO REDONDEAR
                    const promedioFinal = truncarA2Decimales(
                      promediosPorTrimestre.reduce((a, b) => a + b, 0) / promediosPorTrimestre.length
                    ).toFixed(2);

                    return (
                      <div className="border-2 border-gray-800 rounded-lg p-4 bg-gray-50">
                        <div className="flex justify-between items-center">
                          <h4 className="font-bold text-lg">NOTA FINAL</h4>
                          <span className={`text-2xl font-bold ${obtenerColorNota(promedioFinal)}`}>
                            {promedioFinal}
                          </span>
                        </div>
                        <p className="text-xs text-gray-600 mt-1">
                          Promedio de {promediosPorTrimestre.length} trimestre{promediosPorTrimestre.length > 1 ? 's' : ''}
                        </p>
                      </div>
                    );
                  }
                  return null;
                })()}

                {notasAlumno.length === 0 && (
                  <p className="text-gray-400 text-sm">No hay notas registradas</p>
                )}
              </div>
            </div>
          </div>
        </div>
      );
          case 'libro':
      const claveLibro = `${idEscuela}-${idMateria}`;
      const registrosLibro = libroTemas[claveLibro] || [];

      if (formLibro) {
        return (
          <div className="min-h-screen bg-gray-50 p-4">
            <div className="max-w-3xl mx-auto">
              <div className="flex items-center gap-4 mb-6">
                <button onClick={() => {
                  setFormLibro(false);
                  setRegistroLibro({
                    fecha: '', asignatura: '', horas: '', unidad: '',
                    alumnosPresentes: '', alumnosAusentes: '',
                    contenidos: '', actividades: '', observaciones: '', folio: ''
                  });
                }} className="p-2 hover:bg-gray-100 rounded">
                  <ArrowLeft className="w-6 h-6" />
                </button>
                <h2 className="text-2xl font-bold">Nuevo Registro - Libro de Temas</h2>
              </div>

              <div className="bg-white p-6 rounded-lg shadow space-y-4">
                <div className="grid grid-cols-2 gap-4">
                  <div>
                    <label className="block mb-1 font-semibold text-sm">Fecha</label>
                    <input
                      type="date"
                      value={registroLibro.fecha}
                      onChange={(e) => setRegistroLibro({...registroLibro, fecha: e.target.value})}
                      className="w-full p-2 border rounded-lg"
                    />
                  </div>
                  <div>
                    <label className="block mb-1 font-semibold text-sm">N¬∞ de Folio</label>
                    <input
                      type="text"
                      value={registroLibro.folio}
                      onChange={(e) => setRegistroLibro({...registroLibro, folio: e.target.value})}
                      placeholder="Ej: 145"
                      className="w-full p-2 border rounded-lg"
                    />
                  </div>
                </div>

                <div>
                  <label className="block mb-1 font-semibold text-sm">Asignatura</label>
                  <input
                    type="text"
                    value={registroLibro.asignatura}
                    onChange={(e) => setRegistroLibro({...registroLibro, asignatura: e.target.value})}
                    placeholder="Nombre de la asignatura"
                    className="w-full p-2 border rounded-lg"
                  />
                </div>

                <div className="grid grid-cols-3 gap-4">
                  <div>
                    <label className="block mb-1 font-semibold text-sm">Horas</label>
                    <input
                      type="text"
                      value={registroLibro.horas}
                      onChange={(e) => setRegistroLibro({...registroLibro, horas: e.target.value})}
                      placeholder="Ej: 2"
                      className="w-full p-2 border rounded-lg"
                    />
                  </div>
                  <div>
                    <label className="block mb-1 font-semibold text-sm">Presentes</label>
                    <input
                      type="text"
                      value={registroLibro.alumnosPresentes}
                      onChange={(e) => setRegistroLibro({...registroLibro, alumnosPresentes: e.target.value})}
                      placeholder="Ej: 28"
                      className="w-full p-2 border rounded-lg"
                    />
                  </div>
                  <div>
                    <label className="block mb-1 font-semibold text-sm">Ausentes</label>
                    <input
                      type="text"
                      value={registroLibro.alumnosAusentes}
                      onChange={(e) => setRegistroLibro({...registroLibro, alumnosAusentes: e.target.value})}
                      placeholder="Ej: 2"
                      className="w-full p-2 border rounded-lg"
                    />
                  </div>
                </div>

                <div>
                  <label className="block mb-1 font-semibold text-sm">Unidad Tem√°tica</label>
                  <input
                    type="text"
                    value={registroLibro.unidad}
                    onChange={(e) => setRegistroLibro({...registroLibro, unidad: e.target.value})}
                    placeholder="Ej: Unidad 3 - Geometr√≠a"
                    className="w-full p-2 border rounded-lg"
                  />
                </div>

                <div>
                  <label className="block mb-1 font-semibold text-sm">Contenidos Desarrollados</label>
                  <textarea
                    value={registroLibro.contenidos}
                    onChange={(e) => setRegistroLibro({...registroLibro, contenidos: e.target.value})}
                    placeholder="Describe los contenidos abordados en la clase..."
                    className="w-full p-3 border rounded-lg h-24 resize-none"
                  />
                </div>

                <div>
                  <label className="block mb-1 font-semibold text-sm">Actividades Realizadas</label>
                  <textarea
                    value={registroLibro.actividades}
                    onChange={(e) => setRegistroLibro({...registroLibro, actividades: e.target.value})}
                    placeholder="Describe las actividades realizadas durante la clase..."
                    className="w-full p-3 border rounded-lg h-24 resize-none"
                  />
                </div>

                <div>
                  <label className="block mb-1 font-semibold text-sm">Observaciones</label>
                  <textarea
                    value={registroLibro.observaciones}
                    onChange={(e) => setRegistroLibro({...registroLibro, observaciones: e.target.value})}
                    placeholder="Observaciones adicionales (opcional)..."
                    className="w-full p-3 border rounded-lg h-20 resize-none"
                  />
                </div>

                <button
                  onClick={() => {
                    if (!registroLibro.fecha || !registroLibro.asignatura || !registroLibro.contenidos) {
                      alert('Completa al menos: fecha, asignatura y contenidos');
                      return;
                    }
                    const nuevos = {
                      ...libroTemas,
                      [claveLibro]: [...registrosLibro, { ...registroLibro, id: Date.now() }]
                    };
                    setLibroTemas(nuevos);
                    guardar('libroTemas', nuevos);
                    setFormLibro(false);
                    setRegistroLibro({
                      fecha: '', asignatura: '', horas: '', unidad: '',
                      alumnosPresentes: '', alumnosAusentes: '',
                      contenidos: '', actividades: '', observaciones: '', folio: ''
                    });
                  }}
                  className={`w-full ${col.p} text-white p-3 rounded-lg font-semibold flex items-center justify-center gap-2`}>
                  <Save className="w-5 h-5" />
                  Guardar Registro
                </button>
              </div>
            </div>
          </div>
        );
      }

      return (
        <div className="min-h-screen bg-gray-50 p-4">
          <div className="max-w-4xl mx-auto">
            <div className="flex items-center gap-4 mb-6">
              <button onClick={() => setPantalla('menu-materia')} className="p-2 hover:bg-gray-100 rounded">
                <ArrowLeft className="w-6 h-6" />
              </button>
              <h2 className="text-2xl font-bold flex-1">Libro de Temas</h2>
              <button
                onClick={() => setFormLibro(true)}
                className={`${col.p} text-white px-4 py-2 rounded-lg flex items-center gap-2`}>
                <Plus className="w-5 h-5" />
                Nuevo Registro
              </button>
            </div>

            <div className="space-y-4">
              {registrosLibro.sort((a, b) => b.fecha.localeCompare(a.fecha)).map(reg => (
                <div key={reg.id} className="bg-white p-6 rounded-lg shadow">
                  <div className="flex justify-between items-start mb-4">
                    <div>
                      <h3 className="text-xl font-bold">{reg.asignatura}</h3>
                      <p className="text-sm text-gray-600">{reg.fecha} {reg.folio && `‚Ä¢ Folio: ${reg.folio}`}</p>
                    </div>
                    <button
                      onClick={() => {
                        if (window.confirm('¬øEliminar registro?')) {
                          const filtrados = registrosLibro.filter(r => r.id !== reg.id);
                          const nuevos = { ...libroTemas, [claveLibro]: filtrados };
                          setLibroTemas(nuevos);
                          guardar('libroTemas', nuevos);
                        }
                      }}
                      className="text-red-600 p-2 hover:bg-red-50 rounded">
                      <Trash2 className="w-5 h-5" />
                    </button>
                  </div>

                  <div className="grid grid-cols-3 gap-4 mb-4 text-sm">
                    {reg.horas && (
                      <div className="bg-blue-50 p-2 rounded">
                        <span className="font-semibold">Horas: </span>{reg.horas}
                      </div>
                    )}
                    {reg.alumnosPresentes && (
                      <div className="bg-green-50 p-2 rounded">
                        <span className="font-semibold">Presentes: </span>{reg.alumnosPresentes}
                      </div>
                    )}
                    {reg.alumnosAusentes && (
                      <div className="bg-red-50 p-2 rounded">
                        <span className="font-semibold">Ausentes: </span>{reg.alumnosAusentes}
                      </div>
                    )}
                  </div>

                  {reg.unidad && (
                    <div className="mb-3">
                      <p className="text-sm font-semibold text-gray-600">Unidad Tem√°tica</p>
                      <p className={`${col.s} ${col.t} p-2 rounded font-semibold`}>{reg.unidad}</p>
                    </div>
                  )}

                  <div className="mb-3">
                    <p className="text-sm font-semibold text-gray-600 mb-1">Contenidos Desarrollados</p>
                    <p className="text-sm bg-gray-50 p-3 rounded">{reg.contenidos}</p>
                  </div>

                  {reg.actividades && (
                    <div className="mb-3">
                      <p className="text-sm font-semibold text-gray-600 mb-1">Actividades Realizadas</p>
                      <p className="text-sm bg-gray-50 p-3 rounded">{reg.actividades}</p>
                    </div>
                  )}

                  {reg.observaciones && (
                    <div>
                      <p className="text-sm font-semibold text-gray-600 mb-1">Observaciones</p>
                      <p className="text-sm bg-yellow-50 p-3 rounded italic">{reg.observaciones}</p>
                    </div>
                  )}
                </div>
              ))}

              {registrosLibro.length === 0 && (
                <div className="bg-white p-12 rounded-lg shadow text-center">
                  <FileText className="w-16 h-16 mx-auto text-gray-300 mb-4" />
                  <h3 className="text-xl font-bold text-gray-400 mb-2">Sin registros</h3>
                  <p className="text-gray-500 mb-4">A√∫n no hay registros en el libro de temas</p>
                  <button
                    onClick={() => setFormLibro(true)}
                    className={`${col.p} text-white px-6 py-3 rounded-lg flex items-center gap-2 mx-auto`}>
                    <Plus className="w-5 h-5" />
                    Crear Primer Registro
                  </button>
                </div>
              )}
            </div>
          </div>
        </div>
      );
          case 'planner-mensual':
      const meses = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
      const diasSemana = ['Dom', 'Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b'];

      const obtenerDiasDelMes = (fecha) => {
        const a√±o = fecha.getFullYear();
        const mes = fecha.getMonth();
        const primerDia = new Date(a√±o, mes, 1);
        const ultimoDia = new Date(a√±o, mes + 1, 0);
        const diasEnMes = ultimoDia.getDate();
        const primerDiaSemana = primerDia.getDay();
        const dias = [];

        for (let i = 0; i < primerDiaSemana; i++) {
          dias.push(null);
        }
        for (let i = 1; i <= diasEnMes; i++) {
          dias.push(i);
        }
        return dias;
      };

      const formatearFecha = (dia) => {
        const a√±o = mesActual.getFullYear();
        const mes = String(mesActual.getMonth() + 1).padStart(2, '0');
        const d = String(dia).padStart(2, '0');
        return `${a√±o}-${mes}-${d}`;
      };

      const mesAnterior = () => {
        const nueva = new Date(mesActual);
        nueva.setMonth(nueva.getMonth() - 1);
        setMesActual(nueva);
      };

      const mesSiguiente = () => {
        const nueva = new Date(mesActual);
        nueva.setMonth(nueva.getMonth() + 1);
        setMesActual(nueva);
      };

      const esHoy = (dia) => {
        if (!dia) return false;
        const hoy = new Date();
        return hoy.getDate() === dia &&
               hoy.getMonth() === mesActual.getMonth() &&
               hoy.getFullYear() === mesActual.getFullYear();
      };

      const tiposEventos = {
        general: { color: 'bg-blue-500', nombre: 'General' },
        clase: { color: 'bg-green-500', nombre: 'Clase' },
        evaluacion: { color: 'bg-red-500', nombre: 'Evaluaci√≥n' },
        reunion: { color: 'bg-purple-500', nombre: 'Reuni√≥n' },
        feriado: { color: 'bg-orange-500', nombre: 'Feriado' }
      };

      if (diaSeleccionado) {
        const fechaKey = formatearFecha(diaSeleccionado);
        const eventosDelDia = eventosCalendario[fechaKey] || [];
        const notasDelDia = notasPlanner[fechaKey] || '';

        return (
          <div className="min-h-screen bg-gray-50 p-4">
            <div className="max-w-2xl mx-auto">
              <div className="flex items-center gap-4 mb-6">
                <button onClick={() => setDiaSeleccionado(null)} className="p-2 hover:bg-gray-100 rounded">
                  <ArrowLeft className="w-6 h-6" />
                </button>
                <div>
                  <h2 className="text-2xl font-bold">{diaSeleccionado} de {meses[mesActual.getMonth()]} {mesActual.getFullYear()}</h2>
                  <p className="text-sm text-gray-600">{diasSemana[new Date(mesActual.getFullYear(), mesActual.getMonth(), diaSeleccionado).getDay()]}</p>
                </div>
              </div>

              <div className="bg-white p-4 rounded-lg shadow mb-4">
                <h3 className="font-bold mb-3">Agregar Evento</h3>
                <div className="space-y-3">
                  <input
                    type="text"
                    value={textoEvento}
                    onChange={(e) => setTextoEvento(e.target.value)}
                    placeholder="Descripci√≥n del evento"
                    className="w-full p-3 border rounded-lg"
                  />
                  
                  <div className="grid grid-cols-2 gap-2">
                    {Object.entries(tiposEventos).map(([key, tipo]) => (
                      <button
                        key={key}
                        onClick={() => setTipoEvento(key)}
                        className={`p-2 rounded-lg font-semibold text-white ${tipo.color} ${tipoEvento === key ? 'ring-4 ring-offset-2 ring-gray-400' : 'opacity-70'}`}>
                        {tipo.nombre}
                      </button>
                    ))}
                  </div>

                  <button
                    onClick={() => {
                      if (textoEvento.trim()) {
                        const nuevosEventos = {
                          ...eventosCalendario,
                          [fechaKey]: [...eventosDelDia, { id: Date.now(), texto: textoEvento, tipo: tipoEvento }]
                        };
                        setEventosCalendario(nuevosEventos);
                        guardar('eventosCalendario', nuevosEventos);
                        setTextoEvento('');
                        setTipoEvento('general');
                      }
                    }}
                    className={`w-full ${col.p} text-white p-3 rounded-lg font-semibold`}>
                    Agregar Evento
                  </button>
                </div>
              </div>

              <div className="bg-white p-4 rounded-lg shadow mb-4">
                <h3 className="font-bold mb-3">Eventos del D√≠a</h3>
                {eventosDelDia.length === 0 ? (
                  <p className="text-gray-400 text-sm">No hay eventos para este d√≠a</p>
                ) : (
                  <div className="space-y-2">
                    {eventosDelDia.map(evento => (
                      <div key={evento.id} className={`p-3 rounded-lg ${tiposEventos[evento.tipo].color} bg-opacity-10 border-l-4 ${tiposEventos[evento.tipo].color} flex justify-between items-center`}>
                        <div>
                          <span className="font-semibold">{evento.texto}</span>
                          <span className="text-xs ml-2 opacity-70">({tiposEventos[evento.tipo].nombre})</span>
                        </div>
                        <button
                          onClick={() => {
                            const filtrados = eventosDelDia.filter(e => e.id !== evento.id);
                            const nuevosEventos = { ...eventosCalendario, [fechaKey]: filtrados };
                            setEventosCalendario(nuevosEventos);
                            guardar('eventosCalendario', nuevosEventos);
                          }}
                          className="text-red-600 p-1 hover:bg-red-100 rounded">
                          <Trash2 className="w-4 h-4" />
                        </button>
                      </div>
                    ))}
                  </div>
                )}
              </div>

              <div className="bg-white p-4 rounded-lg shadow">
                <h3 className="font-bold mb-3">Notas del D√≠a</h3>
                <textarea
                  value={notasDelDia}
                  onChange={(e) => {
                    const nuevasNotas = { ...notasPlanner, [fechaKey]: e.target.value };
                    setNotasPlanner(nuevasNotas);
                    guardar('notasPlanner', nuevasNotas);
                  }}
                  placeholder="Escribe tus notas, observaciones o recordatorios para este d√≠a..."
                  className="w-full p-3 border rounded-lg h-32 resize-none"
                />
              </div>
            </div>
          </div>
        );
      }

      const diasDelMes = obtenerDiasDelMes(mesActual);

      return (
        <div className="min-h-screen bg-gray-50 p-4">
          <div className="max-w-5xl mx-auto">
            <div className="flex items-center gap-4 mb-6">
              <button onClick={irInicio} className="p-2 hover:bg-gray-100 rounded">
                <ArrowLeft className="w-6 h-6" />
              </button>
              <h2 className="text-2xl font-bold flex-1">Planner Mensual</h2>
            </div>

            <div className="bg-white rounded-lg shadow p-4 mb-4">
              <div className="flex items-center justify-between mb-4">
                <button onClick={mesAnterior} className="p-2 hover:bg-gray-100 rounded-lg">
                  <ChevronLeft className="w-6 h-6" />
                </button>
                <h3 className="text-xl font-bold">{meses[mesActual.getMonth()]} {mesActual.getFullYear()}</h3>
                <button onClick={mesSiguiente} className="p-2 hover:bg-gray-100 rounded-lg">
                  <ChevronRight className="w-6 h-6" />
                </button>
              </div>

              <div className="grid grid-cols-7 gap-2">
                {diasSemana.map(dia => (
                  <div key={dia} className={`${col.p} text-white p-2 text-center font-bold text-sm rounded-t-lg`}>
                    {dia}
                  </div>
                ))}

                {diasDelMes.map((dia, idx) => {
                  if (!dia) {
                    return <div key={`empty-${idx}`} className="aspect-square"></div>;
                  }

                  const fechaKey = formatearFecha(dia);
                  const eventosDelDia = eventosCalendario[fechaKey] || [];
                  const tieneNotas = notasPlanner[fechaKey]?.trim();
                  const hoy = esHoy(dia);

                  return (
                    <button
                      key={dia}
                      onClick={() => setDiaSeleccionado(dia)}
                      className={`aspect-square border-2 rounded-lg p-2 hover:shadow-lg transition relative ${
                        hoy ? 'border-yellow-400 bg-yellow-50' : 'border-gray-200 hover:border-gray-300'
                      }`}>
                      <div className={`text-lg font-bold ${hoy ? 'text-yellow-600' : ''}`}>{dia}</div>
                      
                      {eventosDelDia.length > 0 && (
                        <div className="flex flex-wrap gap-1 mt-1">
                          {eventosDelDia.slice(0, 3).map(evento => (
                            <div key={evento.id} className={`w-2 h-2 rounded-full ${tiposEventos[evento.tipo].color}`}></div>
                          ))}
                          {eventosDelDia.length > 3 && (
                            <div className="text-xs text-gray-500">+{eventosDelDia.length - 3}</div>
                          )}
                        </div>
                      )}
                      
                      {tieneNotas && (
                        <div className="absolute bottom-1 right-1">
                          <BookOpen className="w-3 h-3 text-gray-400" />
                        </div>
                      )}
                    </button>
                  );
                })}
              </div>
            </div>

            <div className="bg-white rounded-lg shadow p-4">
              <h3 className="font-bold mb-3">Leyenda</h3>
              <div className="grid grid-cols-2 md:grid-cols-5 gap-2">
                {Object.entries(tiposEventos).map(([key, tipo]) => (
                  <div key={key} className="flex items-center gap-2">
                    <div className={`w-4 h-4 rounded ${tipo.color}`}></div>
                    <span className="text-sm">{tipo.nombre}</span>
                  </div>
                ))}
              </div>
            </div>
          </div>
        </div>
      );
    default:
      return (
        <div className="min-h-screen bg-gray-50 p-4 flex items-center justify-center">
          <div className="text-center">
            <h2 className="text-2xl font-bold mb-4">Funcionalidad en desarrollo</h2>
            <button onClick={irInicio} className={`${col.p} text-white px-6 py-3 rounded-lg`}>
              Volver al Inicio
            </button>
          </div>
        </div>
      );
  }
};

// RENDERIZADO DEL COMPONENTE
const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<AgendaDocente />);

</script>
</body>
</html>
